

<sqml>
	<property name="TIMEOUT" value="0"/>
	<datasources resource="datasource.xml"/>
	<properties resource="datamart.properties"/>

    <command type="java"><![CDATA[
        mailto=script.getProperty("mailto");
        cli_schema=script.getProperty("cli_schema");        
	]]></command>
		       
	<command type="try">
		<try>

        <!--  Update APC raw data, set REBATE_PAID_DT  -->
        <command type="run" datasource="datamart" batch="1000">
        <![CDATA[

        UPDATE rps.BCBS_report
                SET     
                        REBATE_PAID_DT =
                (SELECT max(finev_post_ts)
           FROM  rps.ksrb223_fesumc l
	   WHERE l.RBAT_BILL_PRD_NM='${QPARM}'
		and BE_ID='${RBATE}'
		and TRAN_TYP_CD = 'P1')
        WHERE inv_qtr = '${QPARM}' and REBATE_ID='${RBATE}'

        ]]>
        </command>

        <!--  Update APC raw data, set INVOICED_DT  -->
        <command type="run" datasource="datamart" batch="1000">
        <![CDATA[

        UPDATE rps.BCBS_report
                SET     
                        INVOICED_DT =
                (SELECT max(finev_post_ts)
           FROM  rps.ksrb223_fesumc l
	   WHERE l.RBAT_BILL_PRD_NM='${QPARM}'
		and BE_ID='${RBATE}'
		and TRAN_TYP_CD in ('I1','Q1','Q2','M1','M2','W1','W2') )
        WHERE inv_qtr = '${QPARM}' and REBATE_ID='${RBATE}'

        ]]>
        </command>


		</try>
		<catch>
		</catch>
	</command>
</sqml>
