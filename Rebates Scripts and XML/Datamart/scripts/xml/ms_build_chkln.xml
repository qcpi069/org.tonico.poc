
<!-- build table chkln for prcs_nb -->

<sqml>
        <property name="TIMEOUT" value="0"/>
        <datasources resource="datasource.xml"/>
        <properties resource="datamart.properties"/>

    <command type="java"><![CDATA[
        mailto=script.getProperty("mailto");
        dmt_schema=script.getProperty("dmt_schema");
        ]]></command>

        <command type="try">
                <try>
                        <command type="copy" batch="1000">
                                <source type="sql" datasource="datamart"
					><![CDATA[
  Select prcs_nb, be_id, rbat_afil_cd, ap_vend_id,
		rbat_bill_prd_nm, pmt_mthd_cd,
		clct_prd_beg_dt, clct_prd_end_dt,pmt_post_cd,
		pmt_amt,pmt_rls_dt,
    case when substr(rbat_bill_prd_nm,6,1) = '1' then '03/01/' || substr(rbat_bill_prd_nm,1,4)
                when substr(rbat_bill_prd_nm,6,1) = '2' then '06/01/' || substr(rbat_bill_prd_nm,1,4)
                when substr(rbat_bill_prd_nm,6,1) = '3' then '09/01/' || substr(rbat_bill_prd_nm,1,4)
                when substr(rbat_bill_prd_nm,6,1) = '4' then '12/01/' || substr(rbat_bill_prd_nm,1,4)
        end, 
		stmt_id
 FROM rps.ksrb250_distr , rps.l_stmt_cycle
  where prcs_nb = ${prcs_nb}
   and be_typ_cd = 'R'
   and void_trans_cd not in ('Y')
 and obj_stat_cd = 'C'
 and clct_prd_end_dt between date(stmt_begin_ts) and date(stmt_end_ts)

                                ]]></source>

                                <target
                                        type             = "sql"
                                        datasource       = "datamart"
                                        transaction      = "true"
                                        batch            = "1000"
                                        reportInterval   = "1000"
                                        queryTimeout     = "${TIMEOUT}"
                                ><![CDATA[
					insert into rps.ms_chkln values
						(?,?,?,?,?,?,?,?,?,?,?,?,?)


                                ]]></target>

                        </command>

                </try>
                <catch>
                </catch>
        </command>
</sqml>

