

<sqml>
	<property name="TIMEOUT" value="0"/>
	<datasources resource="datasource.xml"/>
	<properties resource="datamart.properties"/>

    <command type="java"><![CDATA[
        mailto=script.getProperty("mailto");
        cli_schema=script.getProperty("cli_schema");        
	]]></command>
		       
	<command type="try">
		<try>


        <!--  Update APC raw data, set COLLECT_AMT  -->
        <command type="run" datasource="datamart" batch="1000">
        <![CDATA[

	UPDATE rps.BCBS_report r
	  SET COLLECT_AMT =
	      (SELECT case a.invoice_lkp
	                when 0 then 0
	                else r.INVOICE_AMT* (a.collect_lkp/a.invoice_lkp)*-1
	              end
	        FROM  rps.BCBS_adjust_pct a
	      )
	  WHERE inv_qtr = '${QPARM}' and REBATE_ID='${RBATE}'        

        ]]>
        </command>

		</try>
		<catch>
		</catch>
	</command>
</sqml>
