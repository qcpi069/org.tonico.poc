  <sqml>
    <property name="TIMEOUT" value="0"/>
    <datasources resource="datasource.xml"/>
    <properties resource="datamart.properties"/>
        <command type="java"><![CDATA[
        mailto=script.getProperty("mailto");
        dmt_schema=script.getProperty("dmt_schema");
    cli_schema=script.getProperty("cli_schema");
    ]]></command>


    <command type="try">
    <try>
        
    <command type="copy" batch="1000">
                <source type="sql" datasource="edwdb"><![CDATA[
        SELECT
        NABP_CODE,
        PHMCY_CHAIN_CODE
          FROM DMA_RBATE2.V_PMCY_DENORM
        WHERE NABP_CODE IS NOT NULL
                
                
                ]]></source>
                   <target
                    type             = "sql"
                    datasource       = "datamart"
                    transaction      = "true"
                    batch            = "1000"
                    reportInterval   = "1000"
                    queryTimeout     = "${TIMEOUT}"
                ><![CDATA[

    INSERT INTO RPS.TPHMCY_CHAIN_CODES
        (NABP_CODE,
         PHMCY_CHAIN_CODE)
       
        VALUES (?, ?)

                ]]></target>
        
    </command>
    
    </try>
    <catch>
    <!-- Send an email on error -->
            <command
                type="mail"
                mailTo="${mailto}"
                mailFrom="DM TPHMCY_CHAIN_CODES"
                subject="[ERROR] REFESH - DM TPHMCY_CHAIN_CODES"
                contentType="text/html"
                throwsException="false"
            ><![CDATA[
                <html>
                <head>
                <title>[ERROR] DM TPHMCY_CHAIN_CODES load </title>
                </head>
                <body>
            
                <h3><u>[ERROR] DM TPHMCY_CHAIN_CODES </u></h3>
            
                <table cellpadding="2">
                    <tr><td><b>Host:</b></td><td>${localhost}<td></tr>
                    <tr><td><b>Started:</b></td><td>${startTime}<td></tr>
                    <tr><td><b>Script:</b></td><td>${scriptName}<td></tr>
                    #if (${system.getProperty('logfile')})
                        <tr>
                            <td><b>Log File:</b></td>
                            <td>
                                ${system.getProperty('logfile')}
                            <td>
                        </tr>
                    #end
                </table>

                <br>            
                <br>
                
                #if (${script.getLastStatement()})
                    <h3><u>Last Statement</u></h3>
                    <font style="color: blue; font-size: small">    
                    ${script.getLastStatement()}
                    </font>
                
                    <br>
                    <br>
                #end
            
                <h3><u>Stack Trace</u></h3>     
                <pre style="color: red; font-size: small;">${stackTrace}</pre>
                </body>
                </html>
            ]]>
             </command>
        </catch>
    </command>
  </sqml>

